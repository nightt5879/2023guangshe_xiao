# 2023guangshe
 
# 0.区赛总体流程汇总
## 0.0 出发前
### 0.0.0 选择队伍
根据群里说的和之前提问之类的，应该是在识别地图前知道了<b>队伍</b><br>
此时考虑程序开始前一直<b>“死循环</b> 直到知道了队伍后按键进行选择（依然保持 按一下不动等一段时间是A队伍，按下之后再按一下就是B队伍的逻辑）
### 0.0.1 地图识别
根据细则已经群里的反馈，大概率是这时候开始就不允许再物理按键输入之类的操作了<br>
所以需要选择队伍之后摄像头一直读取，读取到对的要有LCD显示反馈<br>
（这里由于显示文字没弄并且还需要字体库很麻烦，直接平板写字截屏，显示对应的文字图片）
#### 0.0.1.0 成功识别地图
显示识别后的地图并且显示一张文字图片<b>【识别成功】</b>
#### 0.0.1.1 显示倒计时
这个阶段主要用于将小车放到出发点，用于矫正陀螺仪已经整体初始化之类的操作<br>
显示的时间倒是具体定，以time.sleep(1)的频率显示 倒计时图片
#### 0.0.1.2 路径规划
识别完成地图需要完成路径规划，规划前显示一个<b>【路径规划中】</b><br>
规划完成后显示<b>【路径规划完成】</b>
#### 0.0.1.3 保存地图坐标点（用于打断后继续寻宝）
保存到一个同目录（或者某个路径）一个txt,以备需要使用中断后重新开始寻宝<br>（不去已经找过的点了）
### 0.0.1 出发前校准
此时已经完成了地图识别，路径规划，需要进行一些校准操作<br>
比如mpu6050，编码器（需要考虑红色蓝色出发点会不会导致灰度“误识别”）<br>
此时LCD显示校准中，校准完成后显示校准完成
### 0.0.2 按键按下出发
此时显示图片<b>【按下出发】</b>，按下后小车就正常开始走了
## 0.1 出发后
小车路径上存在的优化有：<br>
①同一个象限内的宝藏一定是两种颜色，如果看过一个自己颜色宝藏，那另一个宝藏就不需要去了<br>
②己方宝藏总计四个，三个真宝藏一个假宝藏，如果识别到了三个真宝藏就不需要去寻找下一个点了
③如果己方已经找过三个自己颜色宝藏了并且知道最后一个是己方的颜色。这时候不需要识别一定是真的直接撞<br>
需要注意的是宝藏放置有一定的规则，如下图所示:<br>
![宝藏规则图片](./相关通知/20230703 光电竞赛2号文/宝藏摆放.jpg)
## 0.2 
# X. 测试汇总记录
## X.1 整体流程
- [x] 1. 按键选择队伍<br>
    使用按键选择队伍（长按与按下再松开），LCD辅助提示

- [x] 2. 识别宝藏图<br>
    LCD显示图像进行辅助提示，使用按键识别图像并显示识别后的二值化图像<br>
    如果识别有问题在进行二值化显示识别结果确认时候进行长按重新识别.

- [X] 3. 根据坐标完成路劲规划<br>
    根据得到的宝藏坐标进行路劲规划并进行一系列处理输出标准格式的指令

- [X] 4. 进行巡线完成任务<br>
    根据指令执行并完成巡线
  

## X.2 需要解决的问题
- [x] 1. 宝藏分类问题<br>
    存在将蓝色圆形识别成几次蓝色三角之后全是别成不存在宝藏的问题<br>

- [x] 2.路劲规划优化<br>
    在一个象限内找到宝藏后，另外一个宝藏显然就不是需要去的了，<br>
    可以进行寻找下一个象限宝藏的寻找了<br>

- [x] 3.宝藏方向问题
    拐角处的两个宝藏朝向不确定（校赛说了朝向入口，先解决这个先）。<br>
    需要考虑宝藏不一定朝着哪个方向的问题（除非细则有详细说明）。

## X.3 bug汇总
### X.3.1 csi摄像头bug
问题描述：再断电后上电会出现无法读取csi摄像头问题<br>
解决方法：在上电前请不要插入USB摄像头，在上电后打开即可

### X.3.3 USB摄像头宝藏分类bug
问题描述：在多次调用函数 classify_treasure(team="red")时，会出现无法初始化摄像头问题<br>
解决方法：初始化摄像头进行五次尝试，如果不行直接返回该宝藏为假宝藏并结束函数

### X.3.3 PID巡线容易在转弯后异常break
问题描述：转弯后车子处于不稳定状态摄像头读取画面也许有问题可能回触发break<br>
解决方法：利用一个参数将PID巡线控制【在巡线一定时间后】才能触发break

### X.3.4 车子在开始进入宝藏区可能会偏离曲线
问题描述：由于没有陀螺仪闭环+三轮车有一个万向轮导致有几率出发的时候就歪了车头<br>
解决方法：在开始前把车子往前推一小段”缕一缕"万向轮位置，然后再开始
